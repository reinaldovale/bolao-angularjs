"use strict";angular.module("bolao.carrossel",[]).directive("carrossel",["BD","$timeout",function(a,o){return{restrict:"E",transclude:"true",replace:"true",templateUrl:"components/carrossel/diretivas/diretiva-carrossel.html",scope:{totalPaginas:"=",boleiro:"="},controller:["$scope",function(e){e.direcao="esquerda",e.paginas=[];var t=this,i=1,n=function(a){angular.forEach(e.paginas,function(o){return o.conteudo.id===a?void o.exibir():void 0})};e.atualizarPagina=function(t,r){e.direcao=void 0===r?i>=t?"esquerda":"direita":r;var s=!0,l=!1;if(angular.forEach(e.paginas,function(a){a.conteudo.id===i&&(a.ocultar(),l=!0),a.conteudo.id===t&&(s=!1),!s&&l}),s){var c={id:t,jogos:[]};a.pegarRodadaES(e.boleiro.key,c.id).then(function(a){c.jogos=a.data.hits.hits,e.boleiro.rodadas.push(c),o(function(){n(t)},0)})}o(function(){n(t)},0),i=t},e.ehPaginaAtual=function(a){return i===a},e.proximaPagina=function(){var a=i,o=a<e.totalPaginas?++a:1;e.atualizarPagina(o,"direita")},e.paginaAnterior=function(){var a=i,o=a>1?--a:e.totalPaginas;e.atualizarPagina(o,"esquerda")},t.adicionarPagina=function(a){1===i&&a.exibir(),e.paginas.push(a)}}]}}]).directive("pagina",function(){return{require:"^carrossel",restrict:"E",transclude:"true",replace:"true",scope:{conteudo:"="},link:function(a,o,e,t){a.exibir=function(){a.visivel=!0,a.detalheVisivel=!1},a.ocultar=function(){a.visivel=!1,a.detalheVisivel=!1},a.alternarDetalhe=function(){a.detalheVisivel=!a.detalheVisivel},a.ocultar(),t.adicionarPagina(a)},templateUrl:"components/carrossel/diretivas/diretiva-paginas.html"}}),angular.module("bolao.acordeon",[]).directive("acordeon",function(){return{restrict:"E",transclude:"true",replace:"true",templateUrl:"components/acordeon/diretivas/diretiva-acordeon.html",scope:"true",controller:["$scope",function(a){a.itens=[];var o=this,e=[],t=2,i=0,n=[],r=2,s=0,l=0,c=function(a){if(r>s){for(var o=0;o<n.length;o++)if(n[o].boleiro.pontos===a.boleiro.pontos&&n[o].boleiro.placares===a.boleiro.placares){s--;break}a.tipo="item-rebaixado",s++,n.push(a)}else{for(var e=!1,o=0;o<n.length;o++)if(n[o].boleiro.pontos===a.boleiro.pontos&&n[o].boleiro.placares===a.boleiro.placares){e=!0;break}if(e)a.tipo="item-rebaixado",n.push(a);else{var t=n.filter(function(o){return o.boleiro.pontos>a.boleiro.pontos||o.boleiro.pontos===a.boleiro.pontos&&o.boleiro.placares>a.boleiro.placares});if(t.length>0){for(var i=t[0].boleiro.pontos,l=t[0].boleiro.placares,o=1;o<t.length;o++)(t[o].boleiro.pontos>i||t[o].boleiro.pontos===i&&t[o].boleiro.placares>l)&&(i=t[o].boleiro.pontos,l=t[o].boleiro.placares);n=n.filter(function(a){var o=!0;return a.boleiro.pontos===i&&a.boleiro.placares===l&&(a.tipo="",o=!1),o}),a.tipo="item-rebaixado",n.push(a)}}}},d=function(a){if(t>i){for(var o=0;o<e.length;o++)if(e[o].boleiro.pontos===a.boleiro.pontos&&e[o].boleiro.placares===a.boleiro.placares){i--;break}a.tipo="item-premiado",i++,e.push(a)}else{for(var n=!1,o=0;o<e.length;o++)if(e[o].boleiro.pontos===a.boleiro.pontos&&e[o].boleiro.placares===a.boleiro.placares){n=!0;break}if(n)a.tipo="item-premiado",e.push(a);else{var r=e.filter(function(o){return o.boleiro.pontos<a.boleiro.pontos||o.boleiro.pontos===a.boleiro.pontos&&o.boleiro.placares<a.boleiro.placares});if(r.length>0){for(var s=r[0].boleiro.pontos,l=r[0].boleiro.placares,o=1;o<r.length;o++)(r[o].boleiro.pontos<s||r[o].boleiro.pontos===s&&r[o].boleiro.placares<l)&&(s=r[o].boleiro.pontos,l=r[o].boleiro.placares);e=e.filter(function(a){var o=!0;return a.boleiro.pontos===s&&a.boleiro.placares===l&&(a.tipo="",c(a),o=!1),o}),a.tipo="item-premiado",e.push(a)}else c(a)}}};o.adicionarItem=function(o){d(o),a.itens.push(o)},o.abrir=function(o){o===l?a.itens[l].visivel?a.itens[o].ocultar():a.itens[o].exibir():(a.itens[l].ocultar(),a.itens[o].exibir()),l=o}}]}}).directive("item",["BD",function(a){return{require:"^acordeon",restrict:"E",transclude:"true",replace:"true",scope:{boleiro:"=",indice:"@"},link:function(o,e,t,i){o.direcao="esquerda",o.exibir=function(){o.visivel=!0,o.situacao="item-aberto"},o.abrir=function(e){var t=o.boleiro.rodadas;void 0===t&&(o.boleiro.rodadas=t=[]);var n={id:1,jogos:[]};a.pegarRodadaES(o.boleiro.key,n.id).then(function(a){n.jogos=a.data.hits.hits,o.boleiro.rodadas.push(n)}),i.abrir(e)},o.ocultar=function(){o.visivel=!1,o.situacao="item-fechado"},o.ocultar(),i.adicionarItem(o)},templateUrl:"components/acordeon/diretivas/diretiva-item.html"}}]),angular.module("bolao",["bolao.carrossel","bolao.acordeon","ngTouch","googleOauth"]),angular.module("bolao").factory("BD",["$http","$templateCache",function(a,o){var e,t,i={fields:["boleiro","visitante_gols","mandante_gols"],aggs:{boleiros:{terms:{field:"boleiro",size:0,order:{pontos:"desc",placares:"desc"}},aggs:{pontos:{sum:{script:"if(doc['gaba_manda'].value==''||doc['gaba_visit'].value==''||doc['mandante_gols'].value==''||doc['visitante_gols'].value==''){0}else if(doc['gaba_manda'].value==doc['mandante_gols'].value&&doc['gaba_visit'].value==doc['visitante_gols'].value){3}else if((doc['gaba_manda'].value==doc['gaba_visit'].value&&doc['mandante_gols'].value==doc['visitante_gols'].value)||(doc['gaba_manda'].value<doc['gaba_visit'].value&&doc['mandante_gols'].value<doc['visitante_gols'].value)||(doc['gaba_manda'].value>doc['gaba_visit'].value&&doc['mandante_gols'].value>doc['visitante_gols'].value)){1}else{0}"}},placares:{sum:{script:"if(doc['gaba_manda'].value==''||doc['gaba_visit'].value==''||doc['mandante_gols'].value==''||doc['visitante_gols'].value==''){0}else if(doc['gaba_manda'].value==doc['mandante_gols'].value&&doc['gaba_visit'].value==doc['visitante_gols'].value){1}else if((doc['gaba_manda'].value==doc['gaba_visit'].value&&doc['mandante_gols'].value==doc['visitante_gols'].value)||(doc['gaba_manda'].value<doc['gaba_visit'].value&&doc['mandante_gols'].value<doc['visitante_gols'].value)||(doc['gaba_manda'].value>doc['gaba_visit'].value&&doc['mandante_gols'].value>doc['visitante_gols'].value)){0}else{0}"}}}}},size:0},n={query:{bool:{must:[{term:{rodada_id:2}},{term:{boleiro:"reinaldo"}}]}}},r={query:{bool:{must:{term:{rodada_id:1}},must_not:{term:{boleiro:"gabarito"}}}}},s="bd.json",l=function(a){return"Gabarito"!==a.nome?c(a):void(t=a)},c=function(a){for(var o=null,e=0;e<a.rodadas.length;e++){o=a.rodadas[e];for(var i=0;i<o.jogos.length;i++){var n=o.jogos[i],r=t.rodadas[e].jogos[i];n.pontos=d(n,r),3===n.pontos&&o.placares++,o.pontos+=n.pontos}a.pontos=a.pontos+o.pontos,a.placares=a.placares+o.placares}return a.totalRodadas=a.rodadas.length,a},d=function(a,o){return""===o.mandante.gols||""===o.visitante.gols||""===a.mandante.gols||""===a.visitante.gols?0:o.mandante.gols===a.mandante.gols&&o.visitante.gols===a.visitante.gols?3:o.mandante.gols===o.visitante.gols&&a.mandante.gols===a.visitante.gols||o.mandante.gols<o.visitante.gols&&a.mandante.gols<a.visitante.gols||o.mandante.gols>o.visitante.gols&&a.mandante.gols>a.visitante.gols?1:0},u=function(a){return angular.extend(g(a.id),a),a.rodadas=[],a},g=function(a){var o=e.filter(function(o){return o.id===a?o:void 0});return o[0]},p=function(a,o){for(var e=0;e<o.length;e++)if(o[e].id===a)return o[e]};return{pegarBoleirosES:function(){return a({method:"POST",url:"https://fili-us-east-1.searchly.com/bolao/jogo/_search",headers:{Authorization:"Basic c2l0ZTpjZGFhOTgyYjE4MWM0MTRiZTg3Yzk1ODdhOThkMjg5NA=="},data:i,cache:o})},pegarBoleiros:function(){return a({method:"GET",url:s,cache:o,headers:{"X-Api-Secret":"xxx",Authorization:"xxx","Content-Type":"undefined"}}).then(function(a){e=a.data;var o=JSON.parse(JSON.stringify(a.data));return o.filter(l).map(u)})},pegarRodadaES:function(e,t){return n.query.bool.must[0].term.rodada_id=t,n.query.bool.must[1].term.boleiro=e,a({method:"POST",url:"https://fili-us-east-1.searchly.com/bolao/jogo/_search",headers:{Authorization:"Basic c2l0ZTpjZGFhOTgyYjE4MWM0MTRiZTg3Yzk1ODdhOThkMjg5NA=="},data:n,cache:o})},pegarRodadasES:function(e){return r.query.bool.must.term.rodada_id=e,a({method:"POST",url:"https://fili-us-east-1.searchly.com/bolao/jogo/_search",headers:{Authorization:"Basic c2l0ZTpjZGFhOTgyYjE4MWM0MTRiZTg3Yzk1ODdhOThkMjg5NA=="},data:r,cache:o})},atualizarEmLoteES:function(e){return a({method:"POST",url:"https://fili-us-east-1.searchly.com/bolao/jogo/_bulk",headers:{Authorization:"Basic c2l0ZTpjZGFhOTgyYjE4MWM0MTRiZTg3Yzk1ODdhOThkMjg5NA=="},data:e,cache:o})},pegarRodada:function(a,o){var e=g(a);return p(o,e.rodadas)}}}]),angular.module("bolao").controller("NavbarCtrl",["$scope",function(a){a.date=new Date}]),angular.module("bolao").config(["TokenProvider",function(a){var o=document.URL.replace("teste.html","");a.extendConfig({clientId:"1041203641186-p7ift3msto8too87sqtkbq3so9j6qcp0.apps.googleusercontent.com",redirectUri:o+"oauth2callback.html",scopes:["https://www.googleapis.com/auth/userinfo.email"]})}]).controller("Oauth",["$rootScope","$scope","$window","Token",function(a,o,e,t){o.accessToken=t.get(),o.authenticate=function(){var e=o.askApproval?{approval_prompt:"force"}:{};t.getTokenByPopup(e).then(function(e){t.verifyAsync(e.access_token).then(function(){a.$apply(function(){o.accessToken=e.access_token,o.expiresIn=e.expires_in,t.set(e.access_token)})},function(){alert("Failed to verify token.")})},function(){alert("Failed to get token from popup.")})}}]).controller("ControlePrincipal",["$scope","BD",function(a,o){a.boleiros=[],a.gabarito={key:"gabarito"},o.pegarBoleirosES().then(function(o){a.boleiros=o.data.aggregations.boleiros.buckets});var e=a.gabarito.rodadas;void 0===e&&(a.gabarito.rodadas=e=[]);var t={id:1,jogos:[]};o.pegarRodadaES(a.gabarito.key,t.id).then(function(o){t.jogos=o.data.hits.hits,a.gabarito.rodadas.push(t)}),a.atualizar=function(){console.log(a.gabarito)}}]).controller("ControleAtualizacao",["$scope","BD",function(a,o){o.pegarRodadaES("gabarito",1).then(function(o){var e=o.data.hits.hits;if(void 0===a.gabarito&&(a.gabarito={key:"gabarito"}),void 0===a.gabarito.rodadas){a.gabarito.rodadas=[];var t={id:1,jogos:e};a.gabarito.rodadas.push(t)}}),a.atualizar=function(e){o.pegarRodadasES(e).then(function(t){var i="",n=t.data.hits.hits,r=a.gabarito.rodadas.filter(function(a){return a.id===e});angular.forEach(r[0].jogos,function(a){i=i+'{ "update": {"_id":"'+a._id+'"} }\n{ "doc" : {"visitante_gols" : '+a._source.visitante_gols+', "mandante_gols": '+a._source.mandante_gols+'}, "detect_noop": true }\n',angular.forEach(n,function(o){a._source.mandante===o._source.mandante&&(i=i+'{ "update": {"_id":"'+o._id+'"} }\n{ "doc" : {"gaba_visit" : '+a._source.visitante_gols+', "gaba_manda": '+a._source.mandante_gols+'}, "detect_noop": true }\n')})}),o.atualizarEmLoteES(i)})}}]),angular.module("googleOauth",["angularOauth"]).constant("GoogleTokenVerifier",function(a,o){var e=angular.injector(["ng"]);return e.invoke(["$http","$rootScope","$q",function(e,t,i){var n=i.defer(),r="https://www.googleapis.com/oauth2/v1/tokeninfo";return t.$apply(function(){e({method:"GET",url:r,params:{access_token:o}}).success(function(o){o.audience==a.clientId?n.resolve(o):n.reject({name:"invalid_audience"})}).error(function(a,o,e,t){n.reject({name:"error_response",data:a,status:o,headers:e,config:t})})}),n.promise}])}).config(["TokenProvider","GoogleTokenVerifier",function(a,o){a.extendConfig({authorizationEndpoint:"https://accounts.google.com/o/oauth2/auth",scopes:["https://www.googleapis.com/auth/userinfo.email"],verifyFunc:o})}]),angular.module("angularOauth",[]).provider("Token",function(){var a=function(a){var o=[];return angular.forEach(a,function(a,e){o.push(encodeURIComponent(e)+"="+encodeURIComponent(a))}),o.join("&")},o="token",e={},t={clientId:e,redirectUri:e,authorizationEndpoint:e,localStorageName:"accessToken",verifyFunc:e,scopes:[]};this.extendConfig=function(a){t=angular.extend(t,a)},this.$get=["$q","$http","$window","$rootScope",function(i,n,r,s){var l=[];if(angular.forEach(t,function(a,o){a===e&&l.push(o)}),l.length)throw new Error("TokenProvider is insufficiently configured.  Please configure the following options using TokenProvider.extendConfig: "+l.join(", "));if(!t.clientId)throw new Error("clientId needs to be configured using TokenProvider.");var c=function(){return{response_type:t.responseType||o,client_id:t.clientId,redirect_uri:t.redirectUri,scope:t.scopes.join(" ")}},d=function(o){var e=angular.extend(c(),o);return t.authorizationEndpoint+"?"+a(e)};return{get:function(){return localStorage[t.localStorageName]},set:function(a){localStorage[t.localStorageName]=a},clear:function(){localStorage.removeItem(t.localStorageName)},verifyAsync:function(a){return t.verifyFunc(t,a)},getTokenByPopup:function(a,o){o=angular.extend({name:"AuthPopup",openParams:{width:650,height:300,resizable:!0,scrollbars:!0,status:!0}},o);var e=i.defer(),t=d(a),n=function(a){var o=[];return angular.forEach(a,function(a,e){(a||0===a)&&(a=a===!0?"yes":a,o.push(e+"="+a))}),o.join(",")},l=window.open(t,o.name,n(o.openParams));return angular.element(r).bind("message",function(a){a=a.originalEvent||a,a.source==l&&a.origin==window.location.origin&&s.$apply(function(){a.data.access_token?e.resolve(a.data):e.reject(a.data)})}),e.promise},getTokenInSameWindow:function(a){var o=d(a);r.location.href=o}}}]}).controller("CallbackCtrl",["$scope","$location",function(a,o){function e(a){var o,e,t={};return angular.forEach((a||"").split("&"),function(a){a&&(o=a.split("="),e=decodeURIComponent(o[0]),t[e]=angular.isDefined(o[1])?decodeURIComponent(o[1]):!0)}),t}var t=o.path().substring(1),i=e(t);window.opener.postMessage(i,"*"),window.close()}]),angular.module("bolao").run(["$templateCache",function(a){a.put("components/navbar/navbar.html",'<nav class="navbar" ng-controller="NavbarCtrl"><a href="https://github.com/Swiip/generator-gulp-angular">Gulp Angular</a><ul><li class="active"><a ng-href="#">Home</a></li><li><a ng-href="#">About</a></li><li><a ng-href="#">Contact</a></li></ul><ul><li><a ng-href="#">Current date: {{ date | date:\'yyyy-MM-dd\' }}</a></li></ul></nav>'),a.put("components/acordeon/diretivas/diretiva-acordeon.html",'<div class="acordeon" ng-transclude=""></div>'),a.put("components/acordeon/diretivas/diretiva-item.html",'<div class="item {{situacao}}"><div class="item-cabecalho {{situacao}} {{tipo}}" ng-click="abrir(indice)"><figure><img ng-src="assets/images/avatar/{{boleiro.key}}.jpg"> <img ng-src="assets/images/times/Flamengo.png"><figcaption>Meu campeão: 10 pontos</figcaption></figure><div class="nome">{{boleiro.key}}</div><div class="valores">Pontos<br>{{boleiro.pontos.value}}</div><div class="valores">Placares<br>{{boleiro.placares.value}}</div></div><div ng-transclude=""></div></div>'),a.put("components/carrossel/diretivas/diretiva-carrossel.html",'<div class="carrossel"><nav class="navegacao"><ul class="pontos"><li class="ponto" ng-class="{\'ativo\':ehPaginaAtual($index + 1)}" ng-repeat="pagina in (0|number:totalPaginas - 2 ) track by $index" ng-click="atualizarPagina($index + 1);">{{$index + 1}}</li></ul></nav><div ng-transclude="" class="paginas {{direcao}}" ng-swipe-left="paginaAnterior()" ng-swipe-right="proximaPagina()"></div><a class="seta anterior" ng-click="paginaAnterior()"></a> <a class="seta proxima" ng-click="proximaPagina()"></a></div>'),a.put("components/carrossel/diretivas/diretiva-paginas.html",'<div class="pagina" ng-hide="!visivel"><div class="conteudo" ng-transclude="" ng-click="alternarDetalhe()"></div><div ng-click="alternarDetalhe()" class="detalhe" ng-class="{ocultar : !detalheVisivel}"><table class="detalhe-rodada"><tr><td class="cabecalho-detalhe-rodada" colspan="4">Detalhes da Rodada</td></tr><tr><td class="esquerda">Número:</td><td class="esquerda">{{conteudo.id}}</td><td class="esquerda">Total de Pontos:</td><td class="direita">{{conteudo.pontos}}</td></tr><tr><td class="esquerda">Data:</td><td class="esquerda">{{conteudo.data | date : \'dd/MM/yyyy\'}}</td><td class="esquerda">Total de Placares:</td><td class="direita">{{conteudo.placares}}</td></tr></table></div></div>')}]);