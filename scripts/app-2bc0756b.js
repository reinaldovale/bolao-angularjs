"use strict";angular.module("bolao.carrossel",[]).directive("carrossel",["BD","$timeout",function(o,a){return{restrict:"E",transclude:"true",replace:"true",templateUrl:"components/carrossel/diretivas/diretiva-carrossel.html",scope:{totalPaginas:"=",boleiro:"="},controller:["$scope",function(e){e.direcao="esquerda",e.paginas=[];var t=this,n=1,i=function(o){angular.forEach(e.paginas,function(a){return a.conteudo.id===o?void a.exibir():void 0})};e.atualizarPagina=function(t,r){e.direcao=void 0===r?n>=t?"esquerda":"direita":r;var s=!0,l=!1;if(angular.forEach(e.paginas,function(o){o.conteudo.id===n&&(o.ocultar(),l=!0),o.conteudo.id===t&&(s=!1),!s&&l}),s){var c={id:t,jogos:[]};o.pegarRodadaES(e.boleiro.key,c.id).then(function(o){c.jogos=o.data.hits.hits,e.boleiro.rodadas.push(c),a(function(){i(t)},0)})}a(function(){i(t)},0),n=t},e.ehPaginaAtual=function(o){return n===o},e.proximaPagina=function(){var o=n,a=o<e.totalPaginas?++o:1;e.atualizarPagina(a,"direita")},e.paginaAnterior=function(){var o=n,a=o>1?--o:e.totalPaginas;e.atualizarPagina(a,"esquerda")},t.adicionarPagina=function(o){1===n&&o.exibir(),e.paginas.push(o)}}]}}]).directive("pagina",function(){return{require:"^carrossel",restrict:"E",transclude:"true",replace:"true",scope:{conteudo:"="},link:function(o,a,e,t){o.exibir=function(){o.visivel=!0,o.detalheVisivel=!1},o.ocultar=function(){o.visivel=!1,o.detalheVisivel=!1},o.alternarDetalhe=function(){o.detalheVisivel=!o.detalheVisivel},o.ocultar(),t.adicionarPagina(o)},templateUrl:"components/carrossel/diretivas/diretiva-paginas.html"}}),angular.module("bolao.acordeon",[]).directive("acordeon",function(){return{restrict:"E",transclude:"true",replace:"true",templateUrl:"components/acordeon/diretivas/diretiva-acordeon.html",scope:"true",controller:["$scope",function(o){o.itens=[];var a=this,e=[],t=2,n=0,i=[],r=2,s=0,l=0,c=function(o){if(r>s){for(var a=0;a<i.length;a++)if(i[a].boleiro.pontos===o.boleiro.pontos&&i[a].boleiro.placares===o.boleiro.placares){s--;break}o.tipo="item-rebaixado",s++,i.push(o)}else{for(var e=!1,a=0;a<i.length;a++)if(i[a].boleiro.pontos===o.boleiro.pontos&&i[a].boleiro.placares===o.boleiro.placares){e=!0;break}if(e)o.tipo="item-rebaixado",i.push(o);else{var t=i.filter(function(a){return a.boleiro.pontos>o.boleiro.pontos||a.boleiro.pontos===o.boleiro.pontos&&a.boleiro.placares>o.boleiro.placares});if(t.length>0){for(var n=t[0].boleiro.pontos,l=t[0].boleiro.placares,a=1;a<t.length;a++)(t[a].boleiro.pontos>n||t[a].boleiro.pontos===n&&t[a].boleiro.placares>l)&&(n=t[a].boleiro.pontos,l=t[a].boleiro.placares);i=i.filter(function(o){var a=!0;return o.boleiro.pontos===n&&o.boleiro.placares===l&&(o.tipo="",a=!1),a}),o.tipo="item-rebaixado",i.push(o)}}}},u=function(o){if(t>n){for(var a=0;a<e.length;a++)if(e[a].boleiro.pontos===o.boleiro.pontos&&e[a].boleiro.placares===o.boleiro.placares){n--;break}o.tipo="item-premiado",n++,e.push(o)}else{for(var i=!1,a=0;a<e.length;a++)if(e[a].boleiro.pontos===o.boleiro.pontos&&e[a].boleiro.placares===o.boleiro.placares){i=!0;break}if(i)o.tipo="item-premiado",e.push(o);else{var r=e.filter(function(a){return a.boleiro.pontos<o.boleiro.pontos||a.boleiro.pontos===o.boleiro.pontos&&a.boleiro.placares<o.boleiro.placares});if(r.length>0){for(var s=r[0].boleiro.pontos,l=r[0].boleiro.placares,a=1;a<r.length;a++)(r[a].boleiro.pontos<s||r[a].boleiro.pontos===s&&r[a].boleiro.placares<l)&&(s=r[a].boleiro.pontos,l=r[a].boleiro.placares);e=e.filter(function(o){var a=!0;return o.boleiro.pontos===s&&o.boleiro.placares===l&&(o.tipo="",c(o),a=!1),a}),o.tipo="item-premiado",e.push(o)}else c(o)}}};a.adicionarItem=function(a){u(a),o.itens.push(a)},a.abrir=function(a){a===l?o.itens[l].visivel?o.itens[a].ocultar():o.itens[a].exibir():(o.itens[l].ocultar(),o.itens[a].exibir()),l=a}}]}}).directive("item",["BD",function(o){return{require:"^acordeon",restrict:"E",transclude:"true",replace:"true",scope:{boleiro:"=",indice:"@"},link:function(a,e,t,n){a.direcao="esquerda",a.exibir=function(){a.visivel=!0,a.situacao="item-aberto"},a.abrir=function(e){var t=a.boleiro.rodadas;void 0===t&&(a.boleiro.rodadas=t=[]);var i={id:1,jogos:[]};o.pegarRodadaES(a.boleiro.key,i.id).then(function(o){i.jogos=o.data.hits.hits,a.boleiro.rodadas.push(i)}),n.abrir(e)},a.ocultar=function(){a.visivel=!1,a.situacao="item-fechado"},a.ocultar(),n.adicionarItem(a)},templateUrl:"components/acordeon/diretivas/diretiva-item.html"}}]),angular.module("bolao",["bolao.carrossel","bolao.acordeon","ngTouch","googleOauth"]),angular.module("bolao").factory("BD",["$http","$templateCache",function(o,a){var e,t,n={fields:["boleiro","visitante_gols","mandante_gols"],aggs:{boleiros:{terms:{field:"boleiro",size:0,order:{pontos:"desc",placares:"desc"}},aggs:{pontos:{sum:{script:"if(doc['gaba_manda'].value==''||doc['gaba_visit'].value==''||doc['mandante_gols'].value==''||doc['visitante_gols'].value==''){0}else if(doc['gaba_manda'].value==doc['mandante_gols'].value&&doc['gaba_visit'].value==doc['visitante_gols'].value){3}else if((doc['gaba_manda'].value==doc['gaba_visit'].value&&doc['mandante_gols'].value==doc['visitante_gols'].value)||(doc['gaba_manda'].value<doc['gaba_visit'].value&&doc['mandante_gols'].value<doc['visitante_gols'].value)||(doc['gaba_manda'].value>doc['gaba_visit'].value&&doc['mandante_gols'].value>doc['visitante_gols'].value)){1}else{0}"}},placares:{sum:{script:"if(doc['gaba_manda'].value==''||doc['gaba_visit'].value==''||doc['mandante_gols'].value==''||doc['visitante_gols'].value==''){0}else if(doc['gaba_manda'].value==doc['mandante_gols'].value&&doc['gaba_visit'].value==doc['visitante_gols'].value){1}else if((doc['gaba_manda'].value==doc['gaba_visit'].value&&doc['mandante_gols'].value==doc['visitante_gols'].value)||(doc['gaba_manda'].value<doc['gaba_visit'].value&&doc['mandante_gols'].value<doc['visitante_gols'].value)||(doc['gaba_manda'].value>doc['gaba_visit'].value&&doc['mandante_gols'].value>doc['visitante_gols'].value)){0}else{0}"}}}}},size:0},i={query:{bool:{must:[{term:{rodada_id:2}},{term:{boleiro:"reinaldo"}}]}}},r={query:{bool:{must:{term:{rodada_id:1}},must_not:{term:{boleiro:"gabarito"}}}}},s="bd.json",l=function(o){return"Gabarito"!==o.nome?c(o):void(t=o)},c=function(o){for(var a=null,e=0;e<o.rodadas.length;e++){a=o.rodadas[e];for(var n=0;n<a.jogos.length;n++){var i=a.jogos[n],r=t.rodadas[e].jogos[n];i.pontos=u(i,r),3===i.pontos&&a.placares++,a.pontos+=i.pontos}o.pontos=o.pontos+a.pontos,o.placares=o.placares+a.placares}return o.totalRodadas=o.rodadas.length,o},u=function(o,a){return""===a.mandante.gols||""===a.visitante.gols||""===o.mandante.gols||""===o.visitante.gols?0:a.mandante.gols===o.mandante.gols&&a.visitante.gols===o.visitante.gols?3:a.mandante.gols===a.visitante.gols&&o.mandante.gols===o.visitante.gols||a.mandante.gols<a.visitante.gols&&o.mandante.gols<o.visitante.gols||a.mandante.gols>a.visitante.gols&&o.mandante.gols>o.visitante.gols?1:0},d=function(o){return angular.extend(g(o.id),o),o.rodadas=[],o},g=function(o){var a=e.filter(function(a){return a.id===o?a:void 0});return a[0]},p=function(o,a){for(var e=0;e<a.length;e++)if(a[e].id===o)return a[e]};return{pegarBoleirosES:function(){return o({method:"POST",url:"https://fili-us-east-1.searchly.com/bolao/jogo/_search",headers:{Authorization:"Basic c2l0ZTpjZGFhOTgyYjE4MWM0MTRiZTg3Yzk1ODdhOThkMjg5NA=="},data:n,cache:a})},pegarBoleiros:function(){return o({method:"GET",url:s,cache:a,headers:{"X-Api-Secret":"xxx",Authorization:"xxx","Content-Type":"undefined"}}).then(function(o){e=o.data;var a=JSON.parse(JSON.stringify(o.data));return a.filter(l).map(d)})},pegarRodadaES:function(e,t){return i.query.bool.must[0].term.rodada_id=t,i.query.bool.must[1].term.boleiro=e,o({method:"POST",url:"https://fili-us-east-1.searchly.com/bolao/jogo/_search",headers:{Authorization:"Basic c2l0ZTpjZGFhOTgyYjE4MWM0MTRiZTg3Yzk1ODdhOThkMjg5NA=="},data:i,cache:a})},pegarRodadasES:function(e){return r.query.bool.must.term.rodada_id=e,o({method:"POST",url:"https://fili-us-east-1.searchly.com/bolao/jogo/_search",headers:{Authorization:"Basic c2l0ZTpjZGFhOTgyYjE4MWM0MTRiZTg3Yzk1ODdhOThkMjg5NA=="},data:r,cache:a})},atualizarEmLoteES:function(e){return o({method:"POST",url:"https://fili-us-east-1.searchly.com/bolao/jogo/_bulk",headers:{Authorization:"Basic c2l0ZTpjZGFhOTgyYjE4MWM0MTRiZTg3Yzk1ODdhOThkMjg5NA=="},data:e,cache:a})},pegarRodada:function(o,a){var e=g(o);return p(a,e.rodadas)}}}]),angular.module("bolao").controller("NavbarCtrl",["$scope",function(o){o.date=new Date}]),angular.module("bolao").config(["TokenProvider",function(o){var a=document.URL.replace("teste.html","");o.extendConfig({clientId:"1041203641186-p7ift3msto8too87sqtkbq3so9j6qcp0.apps.googleusercontent.com",redirectUri:a+"oauth2callback.html",scopes:["https://www.googleapis.com/auth/userinfo.email"]})}]).controller("Oauth",["$rootScope","$scope","$window","Token",function(o,a,e,t){a.accessToken=t.get(),a.authenticate=function(){var e=a.askApproval?{approval_prompt:"force"}:{};t.getTokenByPopup(e).then(function(e){t.verifyAsync(e.access_token).then(function(){o.$apply(function(){a.accessToken=e.access_token,a.expiresIn=e.expires_in,t.set(e.access_token)})},function(){alert("Failed to verify token.")})},function(){alert("Failed to get token from popup.")})}}]).controller("ControlePrincipal",["$scope","BD",function(o,a){o.boleiros=[],o.gabarito={key:"gabarito"},a.pegarBoleirosES().then(function(a){o.boleiros=a.data.aggregations.boleiros.buckets});var e=o.gabarito.rodadas;void 0===e&&(o.gabarito.rodadas=e=[]);var t={id:1,jogos:[]};a.pegarRodadaES(o.gabarito.key,t.id).then(function(a){t.jogos=a.data.hits.hits,o.gabarito.rodadas.push(t)}),o.atualizar=function(){console.log(o.gabarito)}}]).controller("ControleAtualizacao",["$scope","BD",function(o,a){a.pegarRodadaES("gabarito",1).then(function(a){var e=a.data.hits.hits;if(void 0===o.gabarito&&(o.gabarito={key:"gabarito"}),void 0===o.gabarito.rodadas){o.gabarito.rodadas=[];var t={id:1,jogos:e};o.gabarito.rodadas.push(t)}}),o.atualizar=function(e){a.pegarRodadasES(e).then(function(t){var n="",i=t.data.hits.hits,r=o.gabarito.rodadas.filter(function(o){return o.id===e});angular.forEach(r[0].jogos,function(o){n=n+'{ "update": {"_id":"'+o._id+'"} }\n{ "doc" : {"visitante_gols" : '+o._source.visitante_gols+', "mandante_gols": '+o._source.mandante_gols+'}, "detect_noop": true }\n',angular.forEach(i,function(a){o._source.mandante===a._source.mandante&&(n=n+'{ "update": {"_id":"'+a._id+'"} }\n{ "doc" : {"gaba_visit" : '+o._source.visitante_gols+', "gaba_manda": '+o._source.mandante_gols+'}, "detect_noop": true }\n')})}),a.atualizarEmLoteES(n)})}}]),angular.module("googleOauth",["angularOauth"]).constant("GoogleTokenVerifier",function(o,a){var e=angular.injector(["ng"]);return e.invoke(["$http","$rootScope","$q",function(e,t,n){var i=n.defer(),r="https://www.googleapis.com/oauth2/v1/tokeninfo";return t.$apply(function(){e({method:"GET",url:r,params:{access_token:a}}).success(function(a){a.audience==o.clientId?i.resolve(a):i.reject({name:"invalid_audience"})}).error(function(o,a,e,t){i.reject({name:"error_response",data:o,status:a,headers:e,config:t})})}),i.promise}])}).config(["TokenProvider","GoogleTokenVerifier",function(o,a){o.extendConfig({authorizationEndpoint:"https://accounts.google.com/o/oauth2/auth",scopes:["https://www.googleapis.com/auth/userinfo.email"],verifyFunc:a})}]),angular.module("angularOauth",[]).provider("Token",function(){var o=function(o){var a=[];return angular.forEach(o,function(o,e){a.push(encodeURIComponent(e)+"="+encodeURIComponent(o))}),a.join("&")},a="token",e={},t={clientId:e,redirectUri:e,authorizationEndpoint:e,localStorageName:"accessToken",verifyFunc:e,scopes:[]};this.extendConfig=function(o){t=angular.extend(t,o)},this.$get=["$q","$http","$window","$rootScope",function(n,i,r,s){var l=[];if(angular.forEach(t,function(o,a){o===e&&l.push(a)}),l.length)throw new Error("TokenProvider is insufficiently configured.  Please configure the following options using TokenProvider.extendConfig: "+l.join(", "));if(!t.clientId)throw new Error("clientId needs to be configured using TokenProvider.");var c=function(){return{response_type:t.responseType||a,client_id:t.clientId,redirect_uri:t.redirectUri,scope:t.scopes.join(" ")}},u=function(a){var e=angular.extend(c(),a);return t.authorizationEndpoint+"?"+o(e)};return{get:function(){return localStorage[t.localStorageName]},set:function(o){localStorage[t.localStorageName]=o},clear:function(){localStorage.removeItem(t.localStorageName)},verifyAsync:function(o){return t.verifyFunc(t,o)},getTokenByPopup:function(o,a){a=angular.extend({name:"AuthPopup",openParams:{width:650,height:300,resizable:!0,scrollbars:!0,status:!0}},a);var e=n.defer(),t=u(o),i=function(o){var a=[];return angular.forEach(o,function(o,e){(o||0===o)&&(o=o===!0?"yes":o,a.push(e+"="+o))}),a.join(",")},l=window.open(t,a.name,i(a.openParams));return angular.element(r).bind("message",function(o){o=o.originalEvent||o,o.source==l&&o.origin==window.location.origin&&s.$apply(function(){o.data.access_token?e.resolve(o.data):e.reject(o.data)})}),e.promise},getTokenInSameWindow:function(o){var a=u(o);r.location.href=a}}}]}).controller("CallbackCtrl",["$scope","$location",function(o,a){function e(o){var a,e,t={};return angular.forEach((o||"").split("&"),function(o){o&&(a=o.split("="),e=decodeURIComponent(a[0]),t[e]=angular.isDefined(a[1])?decodeURIComponent(a[1]):!0)}),t}var t=a.path().substring(1),n=e(t);window.opener.postMessage(n,"*"),window.close()}]);